---
title: "Flutterã®Keyã‚’æ·±æ˜ã‚Šã—ãŸããªã„è©±"
emoji: "ğŸ“š"
type: "tech"
topics: 
  - flutter
published: false
---

ã€Œ`Key`ã£ã¦ã©ã†ã„ã†æ™‚ã«ä½¿ã†ã‚“ã§ã™ã‹ï¼Ÿã€ã¨æ™‚ãŸã¾è³ªå•ã•ã‚Œã‚‹ã®ã§ã€ã€Œ`Key`ã¯ãã‚“ãªã«ä½¿ã†ã‚±ãƒ¼ã‚¹ãŒãªã„ã§ã™ã€ã£ã¦èª¬æ˜ã™ã‚‹ãŸã‚ã®ãƒ¡ãƒ¢ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

## Key

æ‰‹å§‹ã‚ã«ã€`Key`ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã¿ã¾ã™ã€‚

https://api.flutter.dev/flutter/foundation/Key-class.html

> A Key is an identifier for Widgets, Elements and SemanticsNodes.
> 
> A new widget will only be used to update an existing element if its key is the same as the key of the current widget associated with the element.

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ·»ä»˜ã•ã‚Œã¦ã„ã‚‹å‹•ç”»ã§ã¯ã€`Key`ã®ä½¿ã„æ‰€ã¨ã—ã¦ã€Todoãƒªã‚¹ãƒˆã‚„ã‚¿ã‚¤ãƒ«ã®ä¾‹ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚`Key`ã®æ‰±ã„æ–¹ã‚’æŠŠæ¡ã™ã‚‹ã ã‘ã§ã‚ã‚Œã°ã€ã“ã®å‹•ç”»ã®è§£èª¬ã®ç¯„å›²ã§ååˆ†ã§ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãªãŒã‚‰ã€æŒ¯ã‚‹èˆã„ã‚’ååˆ†ã«ç†è§£ã—ãŸã„å ´åˆã«ã¯ã€æ¬¡ã®QiitaãŒãŠå‹§ã‚ã§ã™ã€‚

https://qiita.com/kurun_pan/items/f91228cf5c793ec3f3cc

ã¾ãŸã€æœ¬zennã§ç´¹ä»‹ã—ãŸã„ã¨æ€ã£ã¦ã„ã‚‹å†…å®¹ã‚’ã€åˆ¥å£ã§ç´¹ä»‹ã—ã¦ã„ã‚‹ç¶šç·¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

https://qiita.com/kurun_pan/items/0517fb62f1b47c90882c

---

å€‹äººçš„ãªè¦‹è§£ã¨ã—ã¦ã€`Key`ã‚’æ·±ãç†è§£ã—ã¦ãƒˆãƒªãƒƒã‚­ãƒ¼ãªä½¿ã„æ–¹ã‚’ã™ã‚‹ã‚ˆã‚Šã‚‚ã€åŸºæœ¬çš„ã«`Key`ã«é ¼ã‚‰ãªã„å®Ÿè£…ã‚’ã™ã‚‹ã¹ãã§ã™ã€‚

ã“ã‚Œã¯å‹•ç”»ã®æœ€å¾Œã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã€Œè¤‡æ•°ã®Widgeté–“ã«ãŠã‘ã‚‹çŠ¶æ…‹ã®å…±æœ‰ã€ã¯[Provider](https://pub.dev/packages/provider)ã‚„[Riverpod](https://pub.dev/packages/riverpod)ã‚’çµ„ã¿åˆã‚ã›ãŸå®Ÿè£…ã®æ–¹ãŒã€Œã‚ã‹ã‚Šã‚„ã™ã„ã€ã¨æ€ã†ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚ã¾ãŸFlutterã®æç”»ã¯ååˆ†ã«æ—©ãã€å¤§æŠµã®å ´åˆ`Key`ã«ã‚ˆã‚‹æœ€é©åŒ–ã¯**æ—©ã™ãã‚‹æœ€é©åŒ–**ã«è©²å½“ã™ã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚[dev_toolsã®Performance view](https://docs.flutter.dev/tools/devtools/performance)ä¸Šã§å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã€ãã‚ŒãŒ`Key`ã«ã‚ˆã‚Šè§£æ±ºã™ã‚‹ã“ã¨ãŒæ˜ã‚‰ã‹ãªå ´åˆã‚’é™¤ã‘ã°ã€åˆ©ç”¨ã™ã‚‹ã¹ãã‚·ãƒ¼ãƒ³ã‚‚æ€ã„å½“ãŸã‚Šã¾ã›ã‚“ã€‚

ä¾‹å¤–çš„ãª`Key`ã®ä½¿ã„æ‰€ã¨ã—ã¦ã¯ã€`Form`ã®`GlobalKey<FormState>`ã‚„[go_router](https://pub.dev/packages/go_router)ã®`ShellRoute`ãŒã‚ã‚Šã¾ã™ã€‚
ãŸã ã€ã“ã‚Œã‚‰ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé€šã‚Šã®å®Ÿè£…ã‚’ã™ã‚‹ã¹ãã‚±ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ãŒä¸ååˆ†ãªå ´åˆã§ã‚‚ã€ç‹¬è‡ªã§é ‘å¼µã‚‰ãšã«ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½•ãŒã‚ã‹ã‚‰ãªã„ã®ã‹ã‚’ç¢ºèªã—ãŸæ–¹ãŒè‰¯ã„ã¨æ€ã‚ã‚Œã¾ã™ã€‚

## Keyã®ä½¿ã„ã©ã“ã‚

ä»¥ä¸Šã‚’è¸ã¾ãˆãŸã†ãˆã§ã€`Key`ã®ä½¿ã„æ‰€ã‚’è€ƒãˆã¦ã„ãã¾ã™ã€‚

### LocalKey

https://api.flutter.dev/flutter/foundation/LocalKey-class.html

> A key that is not a GlobalKey.
> 
> Keys must be unique amongst the Elements with the same parent. By contrast, GlobalKeys must be unique across the entire app.

å…¸å‹çš„ã«ã¯ã€`Row`ã‚„`Column`ãªã©ã®è¤‡æ•°ã®å­è¦ç´ (`children`)ã‚’ã‚‚ã¤Widgetã®å­è¦ç´ ã«æŒ‡å®šã—ã¾ã™ã€‚

`LocalKey`ã¯abstract classã¨ãªã‚Šã€ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã¨ã—ã¦[ObjectKey](https://api.flutter.dev/flutter/widgets/ObjectKey-class.html)/[UniqueKey](https://api.flutter.dev/flutter/foundation/UniqueKey-class.html)/[ValueKey](https://api.flutter.dev/flutter/foundation/ValueKey-class.html)ã®3ã¤ã‚’ã‚‚ã¡ã¾ã™ã€‚
`Key('hoge')`ã®ã‚ˆã†ãªè¨˜è¿°ã‚’ã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€`LocalKey`ã‚’ç¶™æ‰¿ã—ãŸ`ValueKey`ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

```dart
@immutable
abstract class Key {
  /// Construct a [ValueKey<String>] with the given [String].
  ///
  /// This is the simplest way to create keys.
  const factory Key(String value) = ValueKey<String>;

  /// Default constructor, used by subclasses.
  ///
  /// Useful so that subclasses can call us, because the [Key.new] factory
  /// constructor shadows the implicit constructor.
  @protected
  const Key.empty();
}
```

`ValueKey`ã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ã“ã®ã‚¯ãƒ©ã‚¹ã®ç›®çš„ã¯ã‚ˆã‚Šã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚(`toString()`ã¯çœç•¥ã—ã¦ã„ã¾ã™ã€‚)
å‹ãŒåŒä¸€å¯å‹•åŒ–ã‚’æ–‡å­—åˆ—ã§æ¯”è¼ƒã—ã€åŒã˜å ´åˆã€å€¤ã‚’æ¯”è¼ƒã™ã‚‹ã ã‘ã§ã™ã€‚`String`ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ã“ã®åˆ¤å®šãŒã‚·ãƒ³ãƒ—ãƒ«ã«è§£æ±ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```dart
class ValueKey<T> extends LocalKey {
  /// Creates a key that delegates its [operator==] to the given value.
  const ValueKey(this.value);

  /// The value to which this key delegates its [operator==]
  final T value;

  @override
  bool operator ==(Object other) {
    if (other.runtimeType != runtimeType) {
      return false;
    }
    return other is ValueKey<T>
        && other.value == value;
  }

  @override
  int get hashCode => Object.hash(runtimeType, value);

  /// toString()ã®å®Ÿè£…ã¯çœç•¥
}
```

ç¶šã„ã¦`UniqueKey`ã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€é•ã„ãŒã‚ˆãã‚ã‹ã‚Šã¾ã™ã€‚

```dart
class UniqueKey extends LocalKey {
  /// Creates a key that is equal only to itself.
  ///
  /// The key cannot be created with a const constructor because that implies
  /// that all instantiated keys would be the same instance and therefore not
  /// be unique.
  // ignore: prefer_const_constructors_in_immutables , never use const for this class
  UniqueKey();

  /// toString()ã®å®Ÿè£…ã¯çœç•¥
}
```

`UniqueKey`ã¯ã€ä¸€è‡´ã®åˆ¤å®šã‚’overrideã—ã¦ã„ã¾ã›ã‚“ã€‚æš—é»™çš„ã«`Object`ã‚¯ãƒ©ã‚¹ã®`==`åˆ¤å®šãŒåˆ©ç”¨ã•ã‚Œã¾ã™ã€‚

https://api.flutter.dev/flutter/dart-core/Object/operator_equals.html

> The default behavior for all Objects is to return true if and only if this object and other are the same object.

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é€šã‚Šã€åŒä¸€ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ãªã„é™ã‚Š`true`ã¨ã¯ãªã‚Šã¾ã›ã‚“ã€‚`final uniqueKey = UniqueKey();`ã®ã‚ˆã†ã«ä¿æŒã—ã€è¤‡æ•°ã®Widgetã«ã‚»ãƒƒãƒˆã—ãªã„é™ã‚Šã€åŒä¸€ã¨ã¯åˆ¤å®šã•ã‚Œãªã„ä»•çµ„ã¿ã¨ãªã‚Šã¾ã™ã€‚
å¾“ã£ã¦ã€`UniqueKey`ã¯é‹ç”¨ä¸Šå¿…ãšuniqueã«ãªã‚Šã¾ã™ã€‚

---

`ObjectKey`ã¯`ValueKey`ã®`==`åˆ¤å®šã‚’ã€dart coreã®`identical`ã«ä»»ã›ã‚‹å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚

```dart
class ObjectKey extends LocalKey {
  /// Creates a key that uses [identical] on [value] for its [operator==].
  const ObjectKey(this.value);

  /// The object whose identity is used by this key's [operator==].
  final Object? value;

  @override
  bool operator ==(Object other) {
    if (other.runtimeType != runtimeType) {
      return false;
    }
    return other is ObjectKey
        && identical(other.value, value);
  }

  @override
  int get hashCode => Object.hash(runtimeType, identityHashCode(value));

  /// toString()ã®å®Ÿè£…ã¯çœç•¥
}
```

https://api.dart.dev/stable/2.19.6/dart-core/identical.html

`identical`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€Œç›´æ„Ÿã«åã™ã‚‹ã‚‚æ­£ã—ã„ã€å‹•ä½œã‚’ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ç¯„å›²ã§ã™ã¨ã€ä¸‹è¨˜ã®ç®‡æ‰€ã§ã™ã€‚
ã“ã®ãŸã‚`ObjectKey`ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã«ã¯ã€æ„å›³ã—ãŸå‹•ä½œãŒãªã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ã¿ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```dart
isIdentical = identical(const Object(), const Object()); // true, const canonicalizes
isIdentical = identical([1], [1]); // false
isIdentical = identical(const [1], const [1]); // true
isIdentical = identical(const [1], const [2]); // false
isIdentical = identical(2, 1 + 1); // true, integers canonicalizes
```

#### LocalKeyã®ä½¿ã„åˆ†ã‘

ç­†è€…ã®è¦‹è§£ã¨ã—ã¦ã¯ã€`LocalKey`ã¯`ValueKey`ã®ã¿ã®åˆ©ç”¨ãŒæœ€ã‚‚å®‰å…¨ã ã¨æ€ã„ã¾ã™ã€‚
ã¾ãŸã€`ValueKey`ã®typeã‚’Stringã‹intã«çµã‚‹ã€ã¤ã¾ã‚Š`ValueKey<String>`ã‹`ValueKey<int>`ã®ã¿åˆ©ç”¨ã™ã‚‹é‹ç”¨ã§è‰¯ã„ã¯ãšã§ã™ã€‚

##### `ObjectKey`

`ObjectKey`ã¯[freezed](https://pub.dev/packages/freezed)ã‚„[equatable](https://pub.dev/packages/equatable)ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€`ValueKey`ã«çµ±ä¸€ã§ãã¾ã™ã€‚ä¸‡ãŒä¸€æŒ¯ã‚‹èˆã„ãŒæœŸå¾…é€šã‚Šå‡ºãªã‹ã£ãŸå ´åˆã§ã‚‚ã€`ValueKey`ã§ã‚ã‚Œã°dartã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã ã‘ã«ãªã‚‹ãŸã‚ã€è§£æã‚‚ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚ã“ã®ãŸã‚ã€ã‹ã¤ã¦ã¯`ObjectKey`ã‚’åˆ©ç”¨ã—ãŸæ–¹ãŒè‰¯ã‹ã£ãŸã‚·ãƒ¼ãƒ³ã«ãŠã„ã¦ã‚‚ã€2023å¹´5æœˆç¾åœ¨ã§ã¯åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒãªããªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

##### `UniqueKey`

`UniqueKey`ã‚’åˆ©ç”¨ã—ãŸããªã‚‹ã‚·ãƒ¼ãƒ³ã§ã¯ã€å°‘ã—ã ã‘æ¤œè¨ã‚’é‡ã­ã¦`ValueKey`ã‚’åˆ©ç”¨ã™ã‚‹ã¹ãã ã¨æ€ã„ã¾ã™ã€‚`UniqueKey`ã¯åˆ©ç”¨ã§ãã‚‹ãŒ`ValueKey`ã¯åˆ©ç”¨ã§ããªã„ã‚·ãƒ¼ãƒ³ã¨ã„ã†ã‚‚ã®ã¯ã‚ã¾ã‚Šæƒ³å®šã§ãã¾ã›ã‚“ã€‚ã“ã®ãŸã‚ã€ã‚ãˆã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«`UniqueKey`ã¨`ValueKey`ã‚’æ··åœ¨ã•ã›ã‚‹ã‚ˆã‚Šã‚‚ã€`ValueKey`ã®ã¿ã®åˆ©ç”¨ã¨ã—ãŸæ–¹ãŒã‚·ãƒ³ãƒ—ãƒ«ã«è€ƒãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

##### `ValueKey`ã®ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§çµã‚‹å‹

`ValueKey`ã®ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§çµã‚‹å‹ã«ã¤ã„ã¦ã¯ã€ãã“ã¾ã§æ°—ã«ã™ã‚‹å¿…è¦ã‚‚ã‚ã‚Šã¾ã›ã‚“ãŒã€ã€Œ`==`ã®åˆ¤å®šã«å•é¡ŒãŒãªã„ã“ã¨ã€ã¨ã€Œ`==`ã®å‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã‚Šã«ãã„ã“ã¨ã€ãŒæ˜ã‚‰ã‹ãªã“ã¨ãŒæœ›ã¾ã—ã„ã¨è¨€ãˆã¾ã™ã€‚ã“ã®2ã¤æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã“ã¨ãŒä¸€ç›®ã§ã‚ã‹ã‚‹ã®ã¯ã€ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã§ã™ã€‚dartã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã®ä¸­ã§ã€ç‰¹ã«åˆ©ç”¨ã—ã‚„ã™ã„ã®ã¯`String`ã¨`int`ã§ã—ã‚‡ã†ã€‚å¿…è¦ãªã‚±ãƒ¼ã‚¹ã§ã¯`freezed`ã‚’åˆ©ç”¨ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€å¤§åŠã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€`String`ã‹`int`ã§ååˆ†ã ã¨æ€ã„ã¾ã™ã€‚

#### LocalKeyã®ä½¿ã„æ‰€

ã¨ã¯ã„ãˆã€`Key`ã®æŒ‡å®šãŒæœ‰åŠ¹ãªã‚±ãƒ¼ã‚¹ã¯å®Ÿã¯å¤šã„ã®ã§ã¯ã€ã¨ã‚‚æ€ã£ã¦ã„ã¾ã™ã€‚
ã¨ã„ã†ã®ã‚‚ã€`Riverpod`ã®`Consumer`ã‚„`ConsumerWidget`ã¯`StatefulWidget`ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ãŸã‚ã€æ„å›³ã›ãš`StatefulWidget`ã‚’`Column`ã‚„`Row`ã®å­è¦ç´ ã«è¨­å®šã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚ã“ã‚Œã‚‰ã¯`ref.watch`ã‚’ã—ã¦ã„ã‚Œã°Providerã®æ›´æ–°ã«å¿œã˜ã¦æç”»ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä¸éƒ½åˆã¯ç”Ÿã˜ã«ãã„ã¨æ€ã†ã®ã§ã™ãŒã€å®Ÿã¯Widgetã®å†åˆ©ç”¨ã‚’ä¿ƒé€²ã§ãã‚‹é¢ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### GlobalKey

https://api.flutter.dev/flutter/widgets/GlobalKey-class.html

`GlobalKey`ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§uniqueãªã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹`Key`ã§ã™ã€‚ã‚¯ãƒ©ã‚¹ã®å®šç¾©ã‚’è¦‹ã‚‹ã¨ã‚ã‹ã‚‹é€šã‚Šã€`currentState`ã«ã¦`State<StatefulWidget>`ã‚’è¿”ã™å®Ÿè£…ã¨ãªã‚Šã¾ã™ã€‚

```dart
@optionalTypeArgs
abstract class GlobalKey<T extends State<StatefulWidget>> extends Key {
  /// Creates a [LabeledGlobalKey], which is a [GlobalKey] with a label used for
  /// debugging.
  ///
  /// The label is purely for debugging and not used for comparing the identity
  /// of the key.
  factory GlobalKey({ String? debugLabel }) => LabeledGlobalKey<T>(debugLabel);

  /// Creates a global key without a label.
  ///
  /// Used by subclasses because the factory constructor shadows the implicit
  /// constructor.
  const GlobalKey.constructor() : super.empty();

  Element? get _currentElement => WidgetsBinding.instance.buildOwner!._globalKeyRegistry[this];

  /// The build context in which the widget with this key builds.
  ///
  /// The current context is null if there is no widget in the tree that matches
  /// this global key.
  BuildContext? get currentContext => _currentElement;

  /// The widget in the tree that currently has this global key.
  ///
  /// The current widget is null if there is no widget in the tree that matches
  /// this global key.
  Widget? get currentWidget => _currentElement?.widget;

  /// The [State] for the widget in the tree that currently has this global key.
  ///
  /// The current state is null if (1) there is no widget in the tree that
  /// matches this global key, (2) that widget is not a [StatefulWidget], or the
  /// associated [State] object is not a subtype of `T`.
  T? get currentState {
    final Element? element = _currentElement;
    if (element is StatefulElement) {
      final StatefulElement statefulElement = element;
      final State state = statefulElement.state;
      if (state is T) {
        return state;
      }
    }
    return null;
  }
}

/// A global key with a debugging label.
///
/// The debug label is useful for documentation and for debugging. The label
/// does not affect the key's identity.
@optionalTypeArgs
class LabeledGlobalKey<T extends State<StatefulWidget>> extends GlobalKey<T> {
  /// Creates a global key with a debugging label.
  ///
  /// The label does not affect the key's identity.
  // ignore: prefer_const_constructors_in_immutables , never use const for this class
  LabeledGlobalKey(this._debugLabel) : super.constructor();

  final String? _debugLabel;

  /// toString()ã®å®Ÿè£…ã¯çœç•¥
}
```

`WidgetsBinding.instance.buildOwner!._globalKeyRegistry[this]`ã¯BuildOwnerã®`final Map<GlobalKey, Element> _globalKeyRegistry = <GlobalKey, Element>{};`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã¾ã™ã€‚
å…ˆè¿°ã®é€šã‚Šã€`Key`ã®`==`ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€åŒä¸€ã®`GlobalKey`ã§ã®ã¿`Element`ã‚’å–å¾—ã§ãã‚‹å‡¦ç†ã§ã™ã€‚`Element`ãŒputã•ã‚Œã‚‹ã®ã¯`Element`ã‚¯ãƒ©ã‚¹ã®`mount`ãƒ¡ã‚½ãƒƒãƒ‰ã€ã–ã£ãã‚Šã„ã†ã¨`StatefulWidget`ãŒç”Ÿæˆã™ã‚‹`StatefulElement`ãŒ`mount`ã•ã‚Œã‚‹æ™‚ã¨ãªã‚Šã¾ã™ã€‚
ã“ã®ã‚ˆã†ã«ã€`GlobalKey`ã¯`LocalKey`ã¨æ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹å½¹å‰²ãŒå…¨ãç•°ãªã‚Šã¾ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«è¡¨ç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚

> Global keys provide access to other objects that are associated with those elements, such as BuildContext. For StatefulWidgets, global keys also provide access to State.

---

`GlobalKey`ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚·ãƒ¼ãƒ³ã¯é™ã‚‰ã‚Œã¦ãã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€Flutterã®Widget(`Form`)ã‚„åˆ¥ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜ã§ããªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒª(`go_router`)ãªã©ã§ã™ã€‚
é€šå¸¸ã®é–‹ç™ºã«ãŠã„ã¦ã¯ã€`GlobalKey`ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ã®ã‚ã‚‹ã‚·ãƒ¼ãƒ³ã¯ã»ã¼ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ãŸã‚[GlobalObjectKey](https://api.flutter.dev/flutter/widgets/GlobalObjectKey-class.html)ã‚„[LabeledGlobalKey](https://api.flutter.dev/flutter/widgets/LabeledGlobalKey-class.html)ã¨ã„ã£ãŸã‚µãƒ–ã‚¯ãƒ©ã‚¹ã‚‚å­˜åœ¨ã—ã¾ã™ãŒã€ã©ã†ã—ã¦ã‚‚å¿…è¦ã«ãªã‚‹ã¾ã§ã¯ç¢ºèªã—ãªãã¦è‰¯ã„ã¨æ€ã‚ã‚Œã¾ã™ã€‚

## ã¾ã¨ã‚

ä¾‹ãˆã°Listã®ä¸¦ã¹åŒ–ãªã©ã§ã¯ã€`Key`ã«é©åˆ‡ãªå€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã“ã¨ã§ã€æ„å›³é€šã‚Šã®æŒ¯ã‚‹èˆã„ã‚’ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ä¸€æ–¹ã§ã€é©å½“ã«`Key`ã‚’ã‚»ãƒƒãƒˆã—ã¦ã„ã‚‹ã¨ã€æ„å›³ã—ãªã„ç®‡æ‰€ã§æç”»ãŒæ··ã–ã£ã¦ã—ã¾ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚
åŸºæœ¬çš„ã«`StatelessWidget`ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€`Key`ã¯æ°—ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
å”¯ä¸€`Column`ã‚„`Row`ã®è¦ç´ ã¨ã—ã¦ã€å†åˆ©ç”¨ã—ãŸã„`StatefulWidget`ã‚’æŒã¤`StatlessWidget`ã‚’ç½®ã„ã¦ã„ã‚‹æ™‚ã€`Key`ã®ã‚»ãƒƒãƒˆã«ã‚ˆã‚Šé©åˆ‡ã«WidgetãŒä½¿ã„ã¾ã‚ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒâ€¦â€¦`StatefulWidget`ã§ã¯ãªã`ConsumerWidget`ã‚’ä½¿ã£ã¦ã„ã‚Œã°å•é¡ŒãŒèµ·ããªã„ã¨æ€ã‚ã‚Œã¾ã™ã€‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã«æç”»ãŒé…ã‚Œã‚‹ãªã©ã€ã‚ˆã»ã©ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡ŒãŒãªã„é™ã‚Šã€å¯¾å¿œã‚’æ¤œè¨ã™ã‚‹å¿…è¦ãŒãªã„ã¯ãšã§ã™ã€‚

`Key`ã¯ãã®ã‚„ã‚„ã“ã—ã•ã®å‰²ã«ã€å¯¾å¿œã‚’é€²ã‚ã‚‹ã“ã¨ã§å¾—ã‚‰ã‚Œã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒéå¸¸ã«å°ã•ã„ç®‡æ‰€ã§ã‚ã‚‹ã¨ã€ç­†è€…ã¯æ„Ÿã˜ã¦ã„ã¾ã™ã€‚
å¯èƒ½ãªé™ã‚Š`Key`ã‚’æ°—ã«ã—ãªãã¦æ¸ˆã‚€å®Ÿè£…ã«å–ã‚Šçµ„ã¿ã€å¿«é©ãªFlutterãƒ©ã‚¤ãƒ•ã‚’é€ã‚Šã¾ã—ã‚‡ã†ï¼
