---
title: "ç§è¦‹ã§ã¾ã¨ã‚ã‚‹RiverpodãŒå°å…¥ã™ã‚‹è¨­è¨ˆæ€æƒ³"
emoji: "ğŸ§ "
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [
  "flutter",
  "riverpod",
]
published: true
published_at: "2025-01-30 12:00"
---

ã“ã®è¨˜äº‹ã§ã¯ã€ç­†è€…ã®è¦‹è§£ãƒ™ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™ãŒã€RiverpodãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å°å…¥ã™ã‚‹è¨­è¨ˆæ€æƒ³ã«ã¤ã„ã¦è€ƒå¯Ÿã—ã¾ã™ã€‚çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæŒã¤è¨­è¨ˆæ€æƒ³ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¡ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å½±éŸ¿ã‚’å¼·ãåŠã¼ã—ã¾ã™ã€‚

## è¨­è¨ˆæ€æƒ³

ç­†è€…ãŒè€ƒãˆã‚‹ã€RiverpodãŒå°å…¥ã™ã‚‹ä¸»ãªè¨­è¨ˆãƒ«ãƒ¼ãƒ«ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

- PDS (Presentation Domain Separation)
- Reactive Programming
- Immutable objects
- å¯Œè±ªçš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° (ã«ã‚ˆã‚‹ç”Ÿç”£æ€§å‘ä¸Š)
- (Implicit interfaceã‚’åˆ©ç”¨ã—ãŸ) DI

ãã‚Œãã‚Œã€ç­†è€…ã®è¦‹è§£ã‚’ãƒ™ãƒ¼ã‚¹ã«è¦ç‚¹ã‚’ã¾ã¨ã‚ã¾ã™ã€‚ã‚ˆã‚Šå³å¯†ãªå®šç¾©ã‚„è©³ç´°ã‚’ç¢ºèªã—ãŸã„æ–¹ã¯ã€å„é …ç›®ã«å¯èƒ½ãªé™ã‚Šãƒªãƒ³ã‚¯ã‚’æ·»ä»˜ã—ã¾ã™ã®ã§ã€ãã¡ã‚‰ã‚’ãƒ™ãƒ¼ã‚¹ã«è€ƒå¯Ÿã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨ã€‚

### PDS (Presentation Demain Separation)

https://martinfowler.com/bliki/PresentationDomainSeparation.html

ç­†è€…ã®ç†è§£ã§ã¯ã€MVCãƒ»MVPãƒ»MVVMãªã©ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€PDSã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šç´°ã‹ãªé•ã„ã¯ã‚ã‚Šã¾ã™ãŒã€ãã‚Œã¯ã©ã®ã‚ˆã†ã«**ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨UIã‚’åˆ†é›¢ã™ã‚‹**ã‹ã®è­°è«–ã®é•ã„ã§ã™ã€‚^[ææ¡ˆã•ã‚ŒãŸæ™‚ä»£ã®å½±éŸ¿ã‚’å¼·ãå—ã‘ã‚‹ãŸã‚ã€å³å¯†ã«ä¸¦åˆ—ãªå­˜åœ¨ã§ã¯ãªã„ãªï¼Ÿ ã¨æ€ã£ã¦ã„ã¾ã™ã€‚]

Flutterã§ã¯ã€çŠ¶æ…‹ã‚’`StatefulWidget`ã®`State`ã«è¨˜è¿°ã§ãã¾ã™ã€‚ã“ã®ä»•çµ„ã¿ã¯ã€`Widget build(BuildContext context)`ãƒ¡ã‚½ãƒƒãƒ‰ã®çµæœã¨ã—ã¦æç”»ã•ã‚Œã‚‹*View*ã¨ã€ãã®Viewã«å¯¾ã™ã‚‹*Logic*ã‚’åˆ†é›¢ã—ã¾ã™ã€‚å½“ãŸã‚Šå‰ã™ãã‚‹ãŸã‚è¦‹é€ƒã•ã‚ŒãŒã¡ã§ã™ãŒã€ã“ã®åˆ†é›¢ã¯ã€å®£è¨€çš„UIä»¥å‰ã¨æ¯”è¼ƒã—ã¦ã¿ã‚‹ã¨éå¸¸ã«é‡è¦ã§ã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

Viewã«å¯¾å¿œã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã®ä»–ã«è­°è«–ã™ã‚‹ã¹ããƒ­ã‚¸ãƒƒã‚¯ã¨ã„ãˆã°ã€**ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**ã§ã™ã€‚

https://docs.flutter.dev/app-architecture/guide

> In Flutter, views are the widget classes of your application. Views are the primary method of rendering UI, and shouldn't contain any business logic. They should be passed all data they need to render from the view model.

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚¬ã‚¤ãƒ‰ã¯`MVVM`ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ãŒã€ãã“ã§ã‚‚**ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**ã¨**UI**ã®åˆ†é›¢ãŒå¼·èª¿ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã€`StatefulWidget`ã®`State`ã‚¯ãƒ©ã‚¹ã«è¨˜è¿°å¯èƒ½ã§ã™ã€‚ã—ã‹ã—ã€ã“ã‚Œã‚’è¡Œãªã£ã¦ã—ã¾ã†ã¨ã€Viewç”¨ã®ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒ1ã‚«æ‰€ã«æ··åœ¨ã—ã¦ã—ã¾ã„ã¾ã™ã€‚ã†ã¾ãæ··åœ¨ã•ã›ã‚Œã°ä½•ã¨ã‹ãªã‚‹ã‹ã‚‚ãªã®ã§ã™ãŒã€å¤šãã®å ´åˆã€ä»•çµ„ã¿ã‚’å°å…¥ã—ã¦æ··åœ¨ã‚’é¿ã‘ã¾ã™ã€‚ã“ã‚ŒãŒã€ã•ã¾ã–ã¾ãªçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒç™»å ´ã™ã‚‹ç†ç”±ã§ã™ã€‚

Flutterã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯`InheritedWidget`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§UIã‹ã‚‰åˆ†é›¢å¯èƒ½ã§ã™ã€‚`InheritedWidget`ãŒãƒ­ã‚¸ãƒƒã‚¯ã‚’ã¾ã¨ã‚ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…å¸ƒã—ã€UIãŒ`context`çµŒç”±ã§å‚ç…§ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚ã“ã®è¨­è¨ˆã®æ¬ ç‚¹ã¯ã€ç¿’å¾—ã‚³ã‚¹ãƒˆãŒé«˜ãã€ã‚³ãƒ¼ãƒ‰è¨˜è¿°é‡ã‚‚å¤šã„ã“ã¨ã§ã™ã€‚çµæœã¨ã—ã¦ã€ã‚¹ã‚±ãƒ¼ãƒ«ã—ã«ãã„ä»•çµ„ã¿ã¨è¨€ãˆã¾ã™ã€‚
ç¾æ™‚ç‚¹ã§ã¯ã€`InheritedWidget`ã®ä¸Šè³ªãªãƒ©ãƒƒãƒ‘ãƒ¼ã§ã‚ã‚‹[Provider](https://pub.dev/packages/provider)ã‚’åˆ©ç”¨ã™ã‚‹æ–¹ãŒä¸€èˆ¬çš„ã§ã™ã€‚æœ¬è³ªçš„ã«ã¯å¤§ããªé•ã„ãŒã‚ã‚Šã¾ã›ã‚“ãŒã€ã—ã‹ã—ã‚³ãƒ¼ãƒ‰ã®èª­ã¿ã‚„ã™ã•ã‚„è¨˜è¿°é‡ã®é•ã„ã¯å¤§ããªã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

**ã‚ˆã‚Šã‚ˆããƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ã™ã‚‹ã®ã¯ã©ã†ã™ã‚Œã°è‰¯ã„ã‹**ã‚’Flutterã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¯è€ƒãˆç¶šã‘ã¦ã„ã¾ã™ã€‚ãŸã¨ãˆã°[BLoC](https://bloclibrary.dev/bloc-concepts/)ã¯Flutteré»æ˜æœŸã«ç´¹ä»‹ã•ã‚Œã¾ã—ãŸã—ã€[Redux](https://pub.dev/packages/redux)ã‚„[get_it](https://pub.dev/packages/get_it)ã®ã‚ˆã†ãªã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«äººæ°—ã®ã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚è¤‡æ•°å­˜åœ¨ã—ã¾ã™ã€‚

https://docs.flutter.dev/data-and-backend/state-mgmt/options

---

Riverpodã§ã¯ã€`Provider`ã‚„`Notifier`ãŒ^[`BuildContext`ã‚’å‚ç…§ã§ããªã„ãŸã‚]ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…ã„ã€`WidgetRef`çµŒç”±ã§UIãŒå‚ç…§ã—ã¾ã™ã€‚Riverpodã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’`Provider`ã‚„`Notifier`ã‚’ä½¿ã£ã¦åˆ†å‰²ã™ã‚‹ã“ã¨åŒç¾©ã§ã™ã€‚ã“ã‚Œã‚’ã¾ã¨ã‚ã‚‹ã¨ã€Riverpodã¯PDSã‚’å®Ÿç¾ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

### Reactive Programming

https://reactivex.io/

> ReactiveX is a combination of the best ideas from the Observer pattern, the Iterator pattern, and functional programming

ç­†è€…ã®ç†è§£ã§ã¯ã€Reactive Programmingã¯**ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã¿ãªã—ã¦å‡¦ç†ã™ã‚‹**æ‰‹æ³•ã§ã™ã€‚ã‚ˆã‚Šå…·ä½“çš„ã«ã¯ã€[rxdart](https://pub.dev/packages/rxdart)ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€å®Ÿç¾ã•ã‚Œã‚‹å®Ÿè£…ã‚’æŒ‡ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã«ã‚ˆã£ã¦ã¯[Iteratorãƒ‘ã‚¿ãƒ¼ãƒ³](https://refactoring.guru/ja/design-patterns/iterator)ã®å´é¢ãŒå¼·ããªã‚Šã¾ã™ãŒã€Flutterã¨Dartã«ãŠã„ã¦ã¯[Observerãƒ‘ã‚¿ãƒ¼ãƒ³](https://refactoring.guru/ja/design-patterns/observer)ã¨ã—ã¦ã®å´é¢ãŒå¼·ã„ã¨æ€ã„ã¾ã™ã€‚

Riverpodã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯ã€Observerãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿä¾‹ã§ã™ã€‚æ¬¡ã®(ç°¡æ˜“çš„ãª)ã‚³ãƒ¼ãƒ‰ã¯`User`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¤‰æ›´ãŒã€`Text(username)`ã«åæ˜ ã•ã‚Œã‚‹ä¾‹ã§ã™ã€‚`ref.watch`ã‚’ä»‹ã—ã¦ã€ãã‚Œãã‚Œã®ObserverãŒUIã«å¤‰æ›´ã‚’åæ˜ ã—ã¾ã™ã€‚

```dart
@riverpod
Stream<User?> user(Ref ref) {
  final auth = ref.watch(authProvider);
  return auth.authStateChanges();
}

@riverpod
String username(Ref ref) {
  final user = ref.watch(userProvider).valueOrNull;
  return user?.username ?? 'none';
}

~~~ç•¥~~~

Widget build(BuildContext context) {
  final username = ref.watch(usernameProvider);
  return Text(username);
}
```

`ref.watch`ã¯ã€å‚ç…§ã—ã¦ã„ã‚‹Providerã®æ›´æ–°ã‚’åæ˜ ã™ã‚‹ã€ã¨ã„ã†ä»•çµ„ã¿ã‚’æŒã£ã¦ã„ã¾ã™ã€‚`userProvider`ãŒpublishã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’`usernameProvider`ãŒsubscribeã€‚ãã—ã¦`usernameProvider`ãŒpublishã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’UIãŒsubscribeã—ã¾ã™ã€‚ç´”ç²‹ãª`Provider`ã¯ã€Rxã«ãŠã‘ã‚‹`map`ã§ã™ã€‚

`Notifier`ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã‚’å—ã‘ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã‚’ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¡¨ç¾ã™ã‚‹`Notifier`ã«åæ˜ ã—ã€`Notifier`ã®å¤‰æ›´ã‚’UIã«åæ˜ ã™ã‚‹ä»•çµ„ã¿ãŒå®Ÿç¾ã•ã‚Œã¾ã™ã€‚

```dart
@riverpod
class Counter extends _$Counter {
  @override
  int build() => 0;

  void increment() {
    state++;
  }
}

@riverpod
String countText(Ref ref) {
  final counter = ref.watch(counterProvider);
  return 'Count: ${counter}';
}

~~~ç•¥~~~

Widget build(BuildContext context) {
  final countText = ref.watch(countTextProvider);
  return Column(
    children: [
      Text(countText),
      ElevatedButton(
        onPressed: () => ref.read(counterProvider.notifier).increment(),
        child: Text('Increment'),
      ),
    ],
  );
}
```

Riverpodã¯Reactive Programmingã®è¨­è¨ˆæ€æƒ³ã‚’å°å…¥ã—ã¦ã„ã¾ã™ã€‚ãƒ™ãƒ¼ã‚¹ã¯Flutterãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒæŒã¤`ChangeNotifier`ã‚’`ListenableBuilder`ã®é–¢ä¿‚ã ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ãŒã€ã‚ˆã‚Šæ´—ç·´ã•ã‚Œä¸€èˆ¬åŒ–ã•ã‚ŒãŸä»•çµ„ã¿ã§ã™ã€‚

### Immutable objects

Dartã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¯”è¼ƒã«ã¤ã„ã¦ãŠã•ã‚‰ã„ã—ã¾ã™ã€‚çŸ¥ã£ã¦ã„ã‚‹ã‚ˆã€ã¨ã„ã†æ–¹ã¯èª­ã¿é£›ã°ã—ã¦ãã ã•ã„ã€‚æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®æŒ¯ã‚‹èˆã„ã¨ã€ãã®ç†ç”±ã‚’ç´¹ä»‹ã™ã‚‹ãƒ‘ãƒ¼ãƒˆã§ã™ã€‚

```dart
void main() {
  final list1 = [1, 2, 3];
  final list2 = list1;
  list2.remove(0);
  print(list1 == list2); // -> true

  const list3 = [1, 2, 3];
  final list4 = [...list3];
  list4.remove(0);
  print(list3 == list4); // -> false
}

```

`list1`ã¨`list2`ã¯åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã—ã¦ã„ã‚‹ãŸã‚ã€`list2`ã®å¤‰æ›´ãŒ`list1`ã«ã‚‚åæ˜ ã•ã‚Œã¾ã™ã€‚ä¸€æ–¹`list3`ã¨`list4`ã¯æ–°ãŸãªãƒªã‚¹ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ãŸã‚ã€`list4`ã®å¤‰æ›´ãŒ`list3`ã«ã¯åæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚

ç¶šã„ã¦ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’DartPadã§å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚

```dart
void main() {
  final list1 = ["Flutter"];
  final list2 = ["Flutter"];
  print(list1 == list2); // -> false

  const list3 = ["Flutter"];
  const list4 = ["Flutter"];
  print(list3 == list4); // -> true
}
```

`list1`ã¨`list2`ã¯åŒã˜`"Flutter"`ã‚’ä¿æŒã™ã‚‹ãƒªã‚¹ãƒˆã§ã™ã€‚å˜ç´”ãªæ¯”è¼ƒã§ã¯ã€ç•°ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ã‚„ã‚„ã“ã—ã„ã®ã§ã™ãŒã€`list3`ã¨`list4`ã¯`const`ã‚’åˆ©ç”¨ã—æœ€é©åŒ–ã•ã‚ŒãŸãŸã‚ã€`true`ãŒè¿”ã•ã‚Œã¾ã™ã€‚

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€æ¬¡ã®ã‚ˆã†ã«æ¯”è¼ƒã™ã‚‹ã“ã¨ã§ã€`list1`ã¨`list2`ã‚’**æ„å›³ã—ãŸé€šã‚Šã«**æ¯”è¼ƒã§ãã¾ã™ã€‚

```dart
import 'package:collection/collection.dart';

void main() {
  final list1 = ["Flutter"];
  final list2 = ["Flutter"];
  print(ListEquality().equals(list1, list2));

  const list3 = ["Flutter"];
  const list4 = ["Flutter"];
  print(list3 == list4);
}
```

åˆ©ç”¨ã—ã¦ã„ã‚‹APIã¯`collection`ã®`ListEquality`ã§ã™ã€‚ãªãŠã€`DeepCollectionEquality`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒªã‚¹ãƒˆã®è¦ç´ ã®é †ç•ªãŒåŒä¸€ã‹ã©ã†ã‹ã‚‚åˆ¤å®šæ¡ä»¶ã«å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`["Flutter", "Developer"]`ã¨`["Developer", "Flutter"]`ã‚’ç•°ãªã‚‹ãƒªã‚¹ãƒˆã¨ã—ã¦åˆ¤å®šã™ã‚‹ã‹ã€åŒä¸€ã®ãƒªã‚¹ãƒˆã¨ã—ã¦åˆ¤å®šã™ã‚‹ã‹ã¯ã€åˆ¤å®šã®æ„å›³ã«ã‚ˆã£ã¦å¤‰ã‚ã‚Šã¾ã™ã€‚å¤§æŠµã®å ´åˆã¯ã€`DeepCollectionEquality`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒªã‚¹ãƒˆã®è¦ç´ ã®é †ç•ªã‚‚è€ƒæ…®ã—ãŸæ¯”è¼ƒãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚^[èª¬æ˜ã®éƒ½åˆä¸Šã€`ListEquality`ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚]

https://api.flutter.dev/flutter/package-collection_collection/ListEquality-class.html

https://api.flutter.dev/flutter/package-collection_collection/DeepCollectionEquality-class.html

---

æ¯”è¼ƒã®å•é¡Œã¯ã€`List`ã‚„`Map`ã ã‘ã®å•é¡Œã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Dartã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ¯”è¼ƒã«ãŠã„ã¦ã‚‚ç™ºç”Ÿã—ã¾ã™ã€‚

```dart
void main() {
  final object1 = GoodClass("first");
  final object2 = object1;
  object2.goodString = "two";

  print(object1 == object2); // -> true
  print(object1.goodString); // -> two
  print(object2.goodString); // -> two
}

class GoodClass {
  GoodClass(
    this.goodString,
  );

  String goodString;
}
```

ä¸Šã®ä¾‹ã§ã¯ã€`object1`ã¨`object2`ã¯åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã—ã¦ã„ã¾ã™ã€‚ã“ã®ä¾‹ã¯ã‚ã‹ã‚‰ã•ã¾ãªä¾‹ã§ã™ãŒã€è¤‡é›‘ãªã‚³ãƒ¼ãƒ‰ã‚„è¾¼ã¿å…¥ã£ãŸã‚³ãƒ¼ãƒ‰ã§ã¯èª¤ã£ã¦å€¤ã‚’æ›´æ–°ã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ä¸Šã®å•é¡Œã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ã‚’å¤–éƒ¨ã‹ã‚‰æ›¸ãæ›ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ç™ºç”Ÿã—ã¦ã„ã‚‹ã¨ã‚‚è¨€ãˆã¾ã™ã€‚`const`ã§å®£è¨€ã§ãã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã€åŒä¸€ã®Stringã‚’ä¸ãˆã¦ã¿ã¾ã™ã€‚

```dart
void main() {
  final object1 = GoodClass("value");
  final object2 = GoodClass("value");

  print(object1 == object2); // -> false
  print(object1.goodString); // -> value
  print(object2.goodString); // -> value
}

class GoodClass {
  const GoodClass(
    this.goodString,
  );

  final String goodString;
}
```

`GoodClass`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’`const`ã§å®£è¨€ã™ã‚‹ã“ã¨ã§ã€`goodString`ã®å€¤ã‚’å¤‰æ›´ã§ããªã„ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã—ã‹ã—`GoodClass`ã®`==`ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€`object1`ã¨`object2`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ¯”è¼ƒã«ãªã£ã¦ã„ã¾ã™ã€‚

https://api.flutter.dev/flutter/dart-core/Object/operator_equals.html

> The default behavior for all Objects is to return true if and only if this object and other are the same object.

ã“ã®å•é¡Œã‚’ã€`==`æ¼”ç®—å­ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ä¿®æ­£ã—ã¾ã™ã€‚

```dart
void main() {
  final object1 = GoodClass("value");
  final object2 = GoodClass("value");

  print(object1 == object2); // -> true
  print(object1.goodString); // -> value
  print(object2.goodString); // -> value
}

class GoodClass {
  const GoodClass(
    this.goodString,
  );

  final String goodString;

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        other is GoodClass && other.goodString == goodString;
  }
}
```

ã“ã‚Œã§`GoodClass`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒåŒä¸€ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

---

https://riverpod.dev/ja/docs/concepts/why_immutability

Riverpodã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¸­ã§ã€[freezed](https://pub.dev/packages/freezed)ã‚„[built_value](https://pub.dev/packages/built_value)ã€ãã—ã¦[equatable](https://pub.dev/packages/equatable)ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€Immutable objectsã‚’ç°¡å˜ã«ç”Ÿæˆã—ã€ã¾ãŸé©åˆ‡ãª`==`æ¼”ç®—å­ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ã‚‚ã—ã‚‚Immutable objectsãŒåˆ©ç”¨ã•ã‚Œãªã„å ´åˆã€Riverpodã¯ã€ä¸ãˆã‚‰ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®equarlsåˆ¤å®šãŒé©åˆ‡ã‹ã©ã†ã‹ã€ã®åˆ¤æ–­ãŒå›°é›£ã«ãªã‚Šã¾ã™ã€‚ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã—ã€ã§ããªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã®å•é¡Œã«å¯¾ã—ã¦ã€Riverpodã¯ä½•ã‚‰ã‹ã®è§£æ±ºç­–ã‚’ç¤ºã—ã¾ã›ã‚“ã€‚åˆ©ç”¨è€…ãŒè‡ªã‚‰ã®è²¬ä»»ã§è§£æ±ºã€ã¤ã¾ã‚ŠImmutable objectsã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚^[ã“ã®è²¬ä»»ã®åˆ‡ã‚Šåˆ†ã‘ã¯å¦¥å½“ã ã¨ç­†è€…ã¯æ„Ÿã˜ã¾ã™ã€‚]

ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’Riverpodã§ç®¡ç†ã—ã¦ã„ã‚‹å ´åˆã€ä¸Šè¨˜ã®ç†ç”±ã«ã‚ˆã‚Šã€ä¸»è¦ãªçŠ¶æ…‹ã¯Immutable objectsã§å®Ÿè£…ã•ã‚Œã¾ã™ã€‚çµæœã¨ã—ã¦ã€Riverpodã¯Immutable objectsã®åˆ©ç”¨ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«(åŠã°)å¼·åˆ¶ã—ã¾ã™ã€‚

### å¯Œè±ªçš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°(ã«ã‚ˆã‚‹ç”Ÿç”£æ€§å‘ä¸Š)

http://www.pitecan.com/fugo.html

https://zenn.dev/mizchi/articles/oop-think-modern

ãã‚‚ãã‚‚Flutterè‡ªä½“ã«ãã†ã„ã£ãŸå´é¢ãŒã‚ã‚Šã¾ã™ãŒã€Riverpodã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã¨ç ´æ£„ã‚„ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãã®ã‚‚ã®ã®ã‚µã‚¤ã‚ºã‚’æŠ‘ãˆã‚‹ã“ã¨ã«é–¢å¿ƒãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã‚€ã—ã‚ã€å®Ÿè£…ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¡å¯èª­æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã«ã€å¤šãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã€Riverpodã«ã¯`autoDispose`ã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€Widgetã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ç´ã¥ã„ãŸçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚`autoDispose`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€çŠ¶æ…‹ã®ç”Ÿæˆã¨ç ´æ£„ã‚’è‡ªå‹•ã§è¡Œãªã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€çŠ¶æ…‹ã®ç®¡ç†ã‚’ç°¡å˜ã«è¡Œãªã†ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ç´°ã¯ã€æ¬¡ã®è¨˜äº‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://zenn.dev/koji_1009/articles/735a08e08b5be9

FlutterãŒDartã‚’è¨€èªã¨ã—ã¦æ¡ç”¨ã—ãŸç†ç”±ã®ã²ã¨ã¤ã«ã€Dartã¯çŸ­å‘½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åŠ¹ç‡çš„ã«æ‰±ã†ã“ã¨ãŒã§ãã‚‹è¨€èªã ã‹ã‚‰ã€ã¨ã„ã†ç†ç”±ãŒã‚ã‚Šã¾ã™ã€‚

https://docs.flutter.dev/resources/faq#why-did-flutter-choose-to-use-dart

> *Fast allocation*
> The Flutter framework uses a functional-style flow that depends heavily on the underlying memory allocator efficiently handling small, short-lived allocations. This style was developed in languages with this property and doesn't work efficiently in languages that lack this facility.

ã§ã‚ã‚Œã°ã€Riverpodã‚’Flutterã§åˆ©ç”¨ã™ã‚‹éš›ã«ã€çŸ­å‘½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¤šãä½œæˆã™ã‚‹ã“ã¨ã¯å•é¡Œã«ãªã‚Šã¾ã›ã‚“ã€‚^[ä½•äº‹ã«ã‚‚ã‚„ã‚Šã™ãã¯ã‚ã‚Šã¾ã™ãŒã€‚]ã“ã‚Œã‚‰ã®äº‹æƒ…ã«ã‚ˆã‚Šã€Riverpodã‚’åˆ©ç”¨ã™ã‚‹ã¨**è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰**ãã®ã‚‚ã®ã«é›†ä¸­ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ä¸€èˆ¬çš„ã«ã¯å¯Œè±ªçš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å‘¼ã°ã‚Œã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã§ã‚ã‚Šã¤ã¤ã‚‚ã€ãã®å•é¡Œç‚¹ã‚’Dartã®è¨€èªç‰¹æ€§ã«ã‚ˆã‚Šè§£æ¶ˆã—ã¦ã„ã‚‹ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚

ãã‚‚ãã‚‚è«–ã§è¨€ãˆã°å®£è¨€çš„UIè‡ªä½“ãŒå¯Œè±ªçš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®å´é¢ã‚’æŒã¡ã¾ã™ã€‚Riverpodã¯ã€ãƒ­ã‚¸ãƒƒã‚¯ã®è¨˜è¿°ã¨å¯Œè±ªçš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šç”Ÿç”£æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚

### (Implicit interfaceã‚’åˆ©ç”¨ã—ãŸ) DI

DI(Dependency Injection)ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®æ‰‹æ³•ã§ã™ã€‚DIã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®çµåˆåº¦ã‚’ä¸‹ã’ã€ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚ã¨ã€ä¸€èˆ¬çš„ãªèª¬æ˜ã‚’æ›¸ãã¾ã—ãŸãŒã€DIãã®ã‚‚ã®ã®èª¬æ˜ã¯kobakeiæ°ã®å‹•ç”»ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://www.youtube.com/watch?v=xizXK_dWU-E

ä»£è¡¨çš„ãªDIã®ä¾‹ã¨ã—ã¦ã€è¤‡æ•°ã®Repositoryã‚’æŒã¤UseCaseã‚’è€ƒãˆã¾ã™ã€‚

```dart
@riverpod
LikeUseCase likeUseCase(Ref ref) {
  return LikeUseCase(
    repository: ref.watch(likeRepositoryProvider),
    analyticsRepository: ref.watch(analyticsRepositoryProvider),
  );
}

class LikeUseCase {
  const LikeUseCase({
    required this.articleRepository,
    required this.analyticsRepository,
  });

  final ArticleRepository articleRepository;
  final AnalyticsRepository analyticsRepository;

  Future<void> like() async {
    await articleRepository.like();
    unawaited(analyticsRepository.sendEvent('like'));
  }

  Future<void> unlike() async {
    await articleRepository.unlike();
    unawaited(analyticsRepository.sendEvent('unlike'));
  }
}
```

`LikeUseCase`ã‚„`LikeUseCase`ã‚’åˆ©ç”¨ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãéš›ã€`LikeUseCase`ã®ä¾å­˜é–¢ä¿‚ã«Mockãªã©ã‚’å·®ã—è¾¼ã‚€å¿…è¦ãŒç”Ÿã˜ã¾ã™ã€‚ã“ã“ã§æ³¨ç›®ã—ãŸã„ã®ã¯ã€Mockã¯`ArticleRepository`ã‚„`AnalyticsRepository`ã®interfaceã‚’å®Ÿè£…ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ç‚¹ã§ã™ã€‚

https://dart.dev/language/classes#implicit-interfaces

Dartã«ã¯Implicit interfaceã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¯ãƒ©ã‚¹ãŒå®Ÿè£…ã—ã¦ã„ã‚‹interfaceã‚’æ˜ç¤ºçš„ã«å®£è¨€ã—ãªãã¦ã‚‚ã€ã‚¯ãƒ©ã‚¹ã®interfaceãŒæš—é»™çš„ã«ç”¨æ„ã•ã‚Œã‚‹ä»•çµ„ã¿ã§ã™ã€‚ã“ã®ä»•çµ„ã¿ãŒã‚ã‚‹ãŸã‚ã€Dartã«ãŠã„ã¦ã¯ã€interfaceã¨implementationã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ†è¹´ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
é€šå¸¸ã¯[Mockito](https://pub.dev/packages/mockito)ã‚„[Mocktail](https://pub.dev/packages/mocktail)ãªã©ã‚’ã€Mockã‚’ä½œæˆã—ã¾ã™ã€‚ã—ã‹ã—ã€ã‚„ã‚Šã‚ˆã†ã«ã‚ˆã£ã¦ã¯æ‰‹ã§Mockã‚’ä½œæˆã§ãã¾ã™ã€‚

```dart
class MockArticleRepository implements ArticleRepository {
  bool liked = false;

  @override
  Future<void> like() async {
    liked = true;
  }

  @override
  Future<void> unlike() async {
    liked = false;
  }
}

class MockAnalyticsRepository implements AnalyticsRepository {
  final List<String> events = String<>[];

  @override
  Future<void> sendEvent(String event) async {
    events.add(event);
  }
}
```

ã‚ã¨ã¯ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦ã€`Provider`ã‚’Mockã«å·®ã—æ›¿ãˆã‚‹ã ã‘ã§ã™ã€‚

```dart
void main() {
  test('LikeUseCase', () {
    final mockArticleRepository = MockArticleRepository();
    final mockAnalyticsRepository = MockAnalyticsRepository();
    final container = createContainer(
      overrides: [
        likeRepositoryProvider.overrideWith(
          (ref) => mockArticleRepository,
        ),
        analyticsRepositoryProvider.overrideWith(
          (ref) => mockAnalyticsRepository,
        ),
      ],
    );

    final likeUseCase = container.read(likeUseCaseProvider);

    expect(likeUseCase.like(), completion(null));
    expect(mockArticleRepository.liked, isTrue);
    expect(mockAnalyticsRepository.events, contains('like'));
    expect(likeUseCase.unlike(), completion(null));
    expect(mockArticleRepository.liked, isFalse);
    expect(mockAnalyticsRepository.events, contains('unlike'));
  });
}

/// https://riverpod.dev/docs/essentials/testing ã‹ã‚‰å¼•ç”¨
ProviderContainer createContainer({
  ProviderContainer? parent,
  List<Override> overrides = const [],
  List<ProviderObserver>? observers,
}) {
  final container = ProviderContainer(
    parent: parent,
    overrides: overrides,
    observers: observers,
  );

  addTearDown(container.dispose);

  return container;
}
```

ã‚³ãƒ¼ãƒ‰ã§ç¤ºã—ãŸã‚ˆã†ã«ã€Riverpodã¯DIã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚ãã—ã¦Dartã®Implicit interfaceã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ¯”è¼ƒçš„ç°¡å˜ã«è¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ã¾ã¨ã‚

RiverpodãŒå°å…¥ã™ã‚‹æ€æƒ³ã€ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã«è¦‹æ…£ã‚Œãªã„ã‚‚ã®ã¯ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã—ã‹ã—ã€Riverpodã¯**ãã‚Œã‚‰ã®çŸ¥è­˜ã‚’å¿…è¦ã¨ã›ãšã¨ã‚‚**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã§ãã‚‹ä»•çµ„ã¿ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚Riverpodã«ã•ã¾ã–ã¾ãªè¨­è¨ˆæ€æƒ³ãŒä¸Šæ‰‹ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€åˆ©ç”¨è€…ã¯æ„è­˜ã‚’å‘ã‘ã‚‹å¿…è¦ãŒã»ã¼ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã“ã§é‡è¦ãªã“ã¨ã¯ã€RiverpodãŒæƒ³å®šã—ã¦ã„ã‚‹æ–¹æ³•ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ãŸã»ã†ãŒã‚ˆã„ã€ã¨ã„ã†ã“ã¨ã§ã™ã€‚Riverpodã®æä¾›ã™ã‚‹æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€è¨­è¨ˆæ€æƒ³ã®ãƒ¡ãƒªãƒƒãƒˆã‚’äº«å—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ç­†è€…ã®åŠ›é‡ä¸è¶³ã§ä¸Šæ‰‹ã«ã¾ã¨ã‚ã‚‰ã‚ŒãŸæ°—ãŒã—ã¦ã„ãªã„ã®ã§ã™ãŒã€è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
