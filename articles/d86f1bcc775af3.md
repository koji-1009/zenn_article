---
title: "Dartã®Uri.httpsã®queryParametersã¯Map<String, dynamic>?ã§ã¯ãªã„"
emoji: "ğŸ“"
type: "tech"
topics: ["dart"]
published: true
published_at: "2021-10-21 17:30"
---

ã‚¿ã‚¤ãƒˆãƒ«ãã®ã¾ã¾ã§ã™ã€‚
ä¸€éƒ¨ã®APIã¯ã‚³ãƒ¼ãƒ‰ã‚’ã¡ã‚‡ã£ã¨è¿½ã£ã‹ã‘ã¦ã€ä»•æ§˜ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ã‚‡ã†ã€‚

---

Dartã®[httpãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](https://pub.dev/packages/http)ã‚’ä½¿ã£ã¦GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã™ã‚‹å ´åˆã®è©±ã§ã™ã€‚

GETã®å ´åˆã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’çµ„ã¿ç«‹ã¦ã‚‹å¿…è¦ãŒç”Ÿã˜ã¾ã™ã€‚
å¤§æŠµã®å ´åˆã€URLãŒæ±ºã¾ã£ã¦ã„ã‚‹ã®ã§ `Uri.parse` ã¨æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã®çµ„ã¿åˆã‚ã›ã§å¯¾å¿œã§ãã¾ã™ã€‚æ¬¡ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

```dart
final url = Uri.parse('https://example.com?a=$b`);
final response = await http.get(url);
```

ã•ã¦ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒnon-nullã§ã‚ã‚Œã°è‰¯ã„ã®ã§ã™ãŒã€nullableãªå ´åˆã«ã€Œæ–‡å­—åˆ—ã«nullã‚’å«ã‚ãŸããªã„ã€ã¨ã„ã†ãŠæ°—æŒã¡ãŒç”Ÿã¾ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚`https://example.com?a=null`ã§ã¯ãªã`https://example.com`ã¨ã—ãŸã„ã€ã¨ã„ã†æ°—æŒã¡ã§ã™ã€‚

æ°—æŒã¡ã®èµ´ãã¾ã¾APIã‚’ç¢ºèªã—ã¦ã„ã‚‹ã¨ã€`Uri.http`ã¨`Uri.https`ãŒç›®ã«ã¤ãã¾ã™ã€‚StackOverFlowãªã‚“ã‹ã‚’è¦‹ã‚‹ã¨è©•åˆ¤ãŒæ‚ªãã†ã§ã™ãŒã€`queryParameters`ã®Mapã‚’æ“ä½œã—ã¦ã‚ã’ã‚Œã°`null`ãŒURLã®ä¸­ã«å…¥ã‚‹ã“ã¨ã‚‚ãªã•ãã†ã§ã™ã€‚

```dart
/// Creates a new `https` URI from authority, path and query.
///
/// This constructor is the same as [Uri.http] except for the scheme
/// which is set to `https`.
factory Uri.https(String authority, String unencodedPath, 
    [Map<String, dynamic>? queryParameters]) = _Uri.https;
```

https://github.com/dart-lang/sdk/blob/2.14.0/sdk/lib/core/uri.dart#L164

ã¨ã“ã‚ãŒã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¨å‹•ãã¾ã›ã‚“ã€‚

```dart
final keyString = "key";
final keyInt = 1;

final uri = Uri.https(
  'example.com',
  'list',
   {
     'keyString': keyString,
     'keyInt': keyInt,
   },
);
final response = await http.get(url);
```

ä¸€æ–¹ã§ã€ä¸‹è¨˜ã®ã‚ˆã†ã«ã™ã‚‹ã¨å‹•ãã¾ã™ã€‚

```dart
final keyString = 'key';
final keyInt = 1;

final uri = Uri.https(
  'example.com',
  'list',
   {
     'keyString': keyString,
     'keyInt': '$keyInt', <- here
   },
);
final response = await http.get(url);
```

---

ã“ã®åŸå› ã‚’æ¢ã‚‹ãŸã‚ã«ã€ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½ã£ã¦ã„ãã¨åŸå› ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```dart
/// Implementation of [Uri.https].
factory _Uri.https(String authority, String unencodedPath,
    [Map<String, dynamic>? queryParameters]) {
  return _makeHttpUri("https", authority, unencodedPath, queryParameters);
}

static _Uri _makeHttpUri(String scheme, String? authority,
  String unencodedPath, Map<String, dynamic>? queryParameters) {
~~~
return _Uri(
  scheme: scheme,
  userInfo: userInfo,
  host: host,
  port: port,
  pathSegments: unencodedPath.split("/"),
  queryParameters: queryParameters);
}

/// Implementation of [Uri.Uri].
factory _Uri(
  {String? scheme,
  String? userInfo,
  String? host,
  int? port,
  String? path,
  Iterable<String>? pathSegments,
  String? query,
  Map<String, dynamic /*String|Iterable<String>*/ >? queryParameters, <- here
  String? fragment}) {
~~~
  query = _makeQuery(query, 0, _stringOrNullLength(query), queryParameters);
~~~
  return _Uri._internal(scheme, userInfo, host, port, path, query, fragment);
}

static String? _makeQuery(String? query, int start, int end,
    Map<String, dynamic /*String|Iterable<String>*/ >? queryParameters) {
~~~
  if (queryParameters == null) return null;
~~~
  queryParameters.forEach((key, value) {
    if (value == null || value is String) { <- here
      writeParameter(key, value);
    } else {
      Iterable values = value;
      for (String value in values) {
        writeParameter(key, value);
      }
    }
  });
  return result.toString();
}
```

https://github.com/dart-lang/sdk/blob/2.14.0/sdk/lib/core/uri.dart#L1412

ã¨ã„ã†ã“ã¨ã§ã€`queryParameters`ã¯`Map<String, dynamic>?`ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ãŒã€å†…éƒ¨çš„ã«`Map<String, dynamic /*String|Iterable<String>*/ >?`ã¨ã—ã¦å‡¦ç†ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

---

æ°—ã«ãªã£ãŸã®ã§Issueç«‹ã¦ã¦ã¿ã¾ã—ãŸã€‚
ä½•ã‚‰ã‹ã®å½¢ã§ç›´ã‚‹ã¨ã„ã„ãªã€‚

https://github.com/dart-lang/language/issues/1919

â€»è¿½è¨˜
Issueã«è¿”ã£ã¦ããŸã‚³ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹ã¨ã€`factory Uri`ã®documentã«æ›¸ã„ã¦ã‚ã‚‹ã‹ã‚‰ãã‚Œã‚’å‚ç…§ã—ã¦æ¬²ã—ã„(æ„è¨³)ã¨ã®ã“ã¨ã§ã—ãŸã€‚å€‹äººçš„ã«ã¯ã€Œã†ã€œã‚“ã€ã¨ã„ã†æ„Ÿã˜ãªã®ã§ã™ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã‚’ç¢ºèªã—ã¦ã‚„ã£ã¦ã„ãã¾ã—ã‚‡ã†ï¼